(()=>{"use strict";var t=document.querySelector(".profile_popup"),e=document.querySelector(".cards_popup"),n=document.querySelector(".image_popup"),r=document.querySelector(".cards"),o=document.querySelector(".profile__plus-button"),u=(document.querySelector(".cards_popup .popup__button-save"),document.querySelector(".cards_popup .popup__close"),document.querySelector(".card__input-name"),document.querySelector(".card__input-url"),document.querySelector("#card-template").content),c=(document.querySelector(".form-addCard"),document.querySelector(".profile__edit-button")),a=(document.querySelector(".popup__close"),t.querySelector(".popup__button-save")),i=document.querySelector(".profile__name"),l=document.querySelector(".profile__subtitle"),s=document.querySelector(".profile__input-name"),d=document.querySelector(".profile__input-description"),f=n.querySelector(".card__full-picture"),p=n.querySelector(".card__full-subtitle"),m=(n.querySelector(".popup__close"),document.querySelector(".profile__avatar")),y=document.querySelector(".avatar-popup"),v=(y.querySelector(".popup__close"),y.querySelector(".popup__button-save"),y.querySelector(".form-avatar")),_=(y.querySelector("input"),{inputErrorClass:"form__input_type_error",spanErrorClass:"form__input-error_active"}),h=document.querySelectorAll(".form"),b={input:".form__input",submitButton:".popup__button-save",buttonInactive:"button_inactive"},S=(document.querySelectorAll(".popup"),document.querySelector(".loading-bar")),g=document.querySelector(".main"),q=document.querySelector(".delete_popup"),E=document.querySelector(".error-text"),L=document.querySelector(".error-popup");function A(t){"Escape"===t.key&&x(document.querySelector(".popup_opened"))}function C(t){t.target.classList.contains("popup_opened")&&x(t.target),t.target.classList.contains("popup__close")&&x(t.target.closest(".popup_opened"))}function k(t){t.classList.add("popup_opened"),t.focus(),t.addEventListener("mousedown",C),t.addEventListener("keydown",A)}function x(t){t.removeEventListener("keydown",A),t.removeEventListener("mousedown",C),t.classList.remove("popup_opened")}function w(t){var e=t.querySelector(".form");e.reset();var n=Array.from(e.querySelectorAll(b.input));n.forEach((function(t){return N(e,t,_)})),U(n,e.querySelector(b.submitButton))}function j(t){t.classList.remove("d-none")}function I(t){t.classList.add("d-none")}function T(t){O(t),t.textContent="Сохраняю..."}function z(t,e){t.textContent=e,P(t)}function O(t){t.classList.add(b.buttonInactive),t.setAttribute("disabled","")}function P(t){t.classList.remove(b.buttonInactive),t.removeAttribute("disabled","")}function D(t){console.log(t.message||t),E.textContent=t&&t.message||t,k(L),setTimeout((function(){x(L)}),2e3)}var N=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.spanErrorClass),r.textContent=""};function U(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?P(e):O(e)}var B,J,M="100a0a32-f941-4db8-a158-a769d9d537de",H="plus-cohort-8",$="https://nomoreparties.co/v1/";function F(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function G(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function K(t,n){t.preventDefault(),j(S);var o=t.submitter.textContent;T(t.submitter);var u,c=(u=t.target.elements.cardLink.value,new Promise((function(t,e){var n=V(u);n.onerror=e,n.onload=t}))).then((function(t){return t.target})),a=c.then((function(e){return e&&(n=t.target.elements.cardName.value,r=t.target.elements.cardLink.value,fetch("".concat($).concat(H,"/cards"),{method:"POST",headers:{authorization:M,"Content-type":"application/json"},body:JSON.stringify({name:n,link:r})}).then(F));var n,r})).catch((function(t){return t.message="Не удалось загрузить изображение. Проверьте правильность ссылки и ваше сетевое соединение.",D(t),t}));Promise.all([c,a]).then((function(t){var o,u,c=(u=2,function(t){if(Array.isArray(t))return t}(o=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,u=[],c=!0,a=!1;try{for(n=n.call(t);!(c=(r=n.next()).done)&&(u.push(r.value),!e||u.length!==e);c=!0);}catch(t){a=!0,o=t}finally{try{c||null==n.return||n.return()}finally{if(a)throw o}}return u}}(o,u)||function(t,e){if(t){if("string"==typeof t)return G(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(t,e):void 0}}(o,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=c[0],i=c[1];r.prepend(R(i,n,a)),x(e)})).catch((function(t){return D(t)})).finally((function(e){I(S),z(t.submitter,o)}))}function Q(){var t,e;(e=J,fetch("".concat($).concat(H,"/cards/").concat(e),{method:"DELETE",headers:{authorization:M}}).then(F)).then((t=B,t.remove(),void(t=null))).then(x(q)).catch((function(t){return D(t)}))}function R(t,e,r){var o=u.querySelector(".card").cloneNode(!0),c=o.querySelector(".card__delete"),a=o.querySelector(".card__like"),i=o.querySelector(".card__like-counter"),l=r||V(t.link);return l.addEventListener("click",(function(){return function(t){f.setAttribute("src",t.src),f.setAttribute("alt",t.alt),p.textContent=t.alt,k(n)}(o.querySelector(".card__picture"))})),l.setAttribute("alt",t.name),o.prepend(l),o.querySelector(".card__title").textContent=t.name,W(a,i,t,e),function(t,e,n,r){t.owner._id==n?e.addEventListener("click",(function(){return function(t,e){B=e,J=t,q.removeEventListener("submit",Q),k(q),q.addEventListener("submit",Q)}(t._id,r)})):e.remove()}(t,c,e,o),a.addEventListener("click",(function(n){!function(t,e,n){j(S),t.target.setAttribute("disabled",""),"true"==t.target.getAttribute("like")?function(t){return fetch("".concat($).concat(H,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:M}}).then(F)}(e).then((function(e){W(t.target,t.target.nextElementSibling,e,n)})).catch((function(t){return D(t)})).finally((function(){t.target.removeAttribute("disabled",""),I(S)})):function(t){return fetch("".concat($).concat(H,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:M}}).then(F)}(e).then((function(e){W(t.target,t.target.nextElementSibling,e,n)})).catch((function(t){return D(t)})).finally((function(){t.target.removeAttribute("disabled",""),I(S)}))}(n,t._id,e)}),!1),o}function V(t){var e=document.createElement("img");return e.src=t,e.classList.add("card__picture"),e}function W(t,e,n,r){n.likes.some((function(t){return t._id==r}))?(t.classList.add("card__like_inverted"),t.setAttribute("like",!0)):(t.classList.remove("card__like_inverted"),t.setAttribute("like",!1)),e.textContent=n.likes&&n.likes.length||0}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Y={},Z=fetch("".concat($).concat(H,"/users/me"),{headers:{authorization:M}}).then(F),tt=Z.then((function(t){return fetch("".concat($).concat(H,"/cards"),{headers:{authorization:M}}).then(F)}));Promise.all([Z,tt]).then((function(t){var e,n,o,u,c,a=(c=2,function(t){if(Array.isArray(t))return t}(u=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,u=[],c=!0,a=!1;try{for(n=n.call(t);!(c=(r=n.next()).done)&&(u.push(r.value),!e||u.length!==e);c=!0);}catch(t){a=!0,o=t}finally{try{c||null==n.return||n.return()}finally{if(a)throw o}}return u}}(u,c)||function(t,e){if(t){if("string"==typeof t)return X(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(t,e):void 0}}(u,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),s=a[0],d=a[1];Y=s,e=s,i.textContent=e.name,l.textContent=e.about,m.style.backgroundImage="url('".concat(e.avatar,"')"),n=d,o=s._id,n.length&&n.forEach((function(t){r.append(R(t,o,null))})),I(S),j(g)})),c.addEventListener("click",(function(){w(t),s.value=i.textContent,d.value=l.textContent,U([s,d],a),k(t)})),t.addEventListener("submit",(function(e){j(S);var n,r,o=e.submitter.textContent;T(e.submitter),e.preventDefault(),(n=s.value,r=d.value,fetch("".concat($).concat(H,"/users/me"),{method:"PATCH",headers:{authorization:M,"Content-type":"application/json"},body:JSON.stringify({name:n,about:r})}).then(F)).then((function(e){i.textContent=e.name,l.textContent=e.about,x(t)})).catch((function(t){return D(t)})).finally((function(t){I(S),z(e.submitter,o)}))})),o.addEventListener("click",(function(){w(e),k(e)})),e.addEventListener("submit",(function(t){K(t,Y._id)})),m.addEventListener("click",(function(){w(y),k(y)})),v.addEventListener("submit",(function(t){j(S);var e,n=t.submitter.textContent;T(t.submitter),t.preventDefault(),(e=t.target.elements.avatarUrl.value,fetch("".concat($).concat(H,"/users/me/avatar"),{method:"PATCH",headers:{authorization:M,"Content-type":"application/json"},body:JSON.stringify({avatar:e})}).then(F)).then((function(t){m.style.backgroundImage="url('".concat(t.avatar,"')"),x(y)})).catch((function(t){return D(t)})).finally((function(e){I(S),z(t.submitter,n)}))})),function(t,e,n){Array.from(t).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e,n){var r=Array.from(t.querySelectorAll(e.input)),o=t.querySelector(e.submitButton);U(r,o),r.forEach((function(e){return e.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?N(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.spanErrorClass)}(t,e,e.validationMessage,n)}(t,e,n),U(r,o)}))}))}(t,e,n)}))}(h,b,_)})();